machine:
  node:
    version: 6.9.5
  services:
    - docker
general:
  branches:
    ignore:
      - master
      - gh-pages
  artifacts:
    - tmp/output

dependencies:
  cache_directories:
    - ~/.yarn-cache
    - ~/.docker
  override:
    - yarn install --cache-folder ~/.yarn-cache --pure-lockfile
    - cd docs/site && yarn install --cache-folder ~/.yarn-cache && cd ../../
    - mkdir -p ~/.docker
    - if [[ -e ~/.docker/hub.tar ]]; then docker load -i ~/.docker/hub.tar; fi
    - if [[ -e ~/.docker/node-chrome.tar ]]; then docker load -i ~/.docker/node-chrome.tar; fi
    - docker-compose up -d
    - if [[ ! -e ~/.docker/hub.tar ]]; then docker save selenium/hub:3.0.1 > ~/.docker/hub.tar; fi
    - if [[ ! -e ~/.docker/node-chrome.tar ]]; then docker save selenium/node-chrome:3.0.1 > ~/.docker/node-chrome.tar; fi

test:
  override:
    - ./scripts/run-travis-tests.sh
  post:
    - bash <(curl -s https://codecov.io/bash)

